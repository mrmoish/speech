<!DOCTYPE html>
<html>
<head>
    <!-- –∫–æ–¥–∏—Ä–æ–≤–∫—É UTF-8 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–º–≤–æ–ª—ã –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤ –º–∏—Ä–∞ -->
    <meta charset="UTF-8">
    <!-- width=device-width - —à–∏—Ä–∏–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞–≤–Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π —à–∏—Ä–∏–Ω–µ —ç–∫—Ä–∞–Ω–∞(–±–µ–∑ —ç–º–∏—Ç–∞—Ü–∏–∏)
            –ú–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —ç–º–∏—Ç–∏—Ä—É–µ—Ç –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π —ç–∫—Ä–∞–Ω (980px)
            –∏ —á—Ç–æ–±—ã –æ–Ω–∞ —É–º–µ—Å—Ç–∏–ª–∞—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–º–µ–Ω—å—à–∞—é—Ç –º–∞—Å—à—Ç–∞–± —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
            –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–º–∏.
        initial-scale=1.0 
            (?)–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –º–∞—Å—à—Ç–∞–± —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±—É–¥–µ—Ç 100% (–Ω–µ –±—É–¥–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é),
            —Ç–∞–∫ —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —É–º–µ–Ω—å—à–µ–Ω–Ω–æ–π –∏–ª–∏ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π.
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESPA√ëOL</title>

    <style>
        body {
            font-family: Tahoma, sans-serif;
            text-align: justify;
            margin: 2em;
            line-height: 3em;
        }
        span{
            color: #ccc;
        }

        strong{
            position: relative;
            display:inline-block;
        }
        strong::before {
            content: attr(data-overlay);
            position: absolute;
            bottom: 50%;
            color: #ccc; 
            white-space: nowrap;

    left: 0;
            /* content: attr(data-overlay);
    position: absolute;

    display:inline-block;
    bottom: 100%;
    left: 0;
    
    
    font-size: 0.8em;
    color: #666;
    
    
    padding: 2px 6px;
    background-color: rgba(240, 240, 240, 0.9);
    border-radius: 4px; */

        }
   
    </style>

    <!-- –æ–¥—Ç–µ–ª–Ω—ã–π —Ñ–∞–π–ª —Ç–∞–∫ –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–æ–ª–∂–µ –ø–æ–ª—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <script  src="speech.js" defer></script>

    <script>

    const selection = window.getSelection();
    let firstI, lastI

    let startFirst, startLast
    document.addEventListener('touchmove', function(event) {
        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–∞—Å–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–∞–ª–µ—Ü–≤
        const x = event.touches[0].clientX;
        const y = event.touches[0].clientY;


    
        // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π —É–∑–µ–ª –ø–æ–¥ –ø–∞–ª—å—Ü–µ–º
        // üî¥ —ç–∫—Å–ø–µ—Ä–º–µ–Ω—Ç–∞–ª–Ω–∞—è —Ñ—É–∫–Ω—Ü–∏—è (–Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç)
        // —Ä–∞–±–∞—Ç–µ–π –≤ —Ö—Ä–æ–º–µ –∏ —Å–∞—Ñ–∞—Ä–µ
        // –Ω–µ —Ä–∞–±–æ–∞—Ç–µ—Ç –≤ —Ñ–∞–∏—Ä—Ñ–æ–∫—Å
        const range = document.caretRangeFromPoint(x, y);


        // –µ—Å–ª–∏ –Ω–µ —Ç–µ–≥ p
        if (range.startContainer.parentElement.tagName !== "P") 
            return;
        

        const text = range.startContainer.textContent; // –¢–µ–∫—Å—Ç —É–∑–ª–∞
        const offset = range.startOffset; // –ò–Ω–¥–µ–∫—Å –±—É–∫–≤—ã –≤ —Ç–µ–∫—Å—Ç–µ

        // –∏–Ω–¥–æ–∫—Å –±–ª–∏–∂–∞–π—à–µ–≥–æ –ø—Ä–æ–±–µ–ª–∞ —Å–ª–µ–≤–æ –æ—Ç –Ω–∞–∂–∞—Ç–∏—è
        const preStart = text.lastIndexOf(' ', offset); 
        // –µ—Å–ª–∏ –ø—Ä–æ–±–µ–ª
        // range.collapsed
        if(preStart === offset) return // –µ—Å–ª–∏ –ø—Ä–æ–±–µ–ª
        let start = preStart+1

        

        if(start === firstI) return // –µ—Å–ª–∏ —Ç–æ–∂–µ —Å–ª–æ–≤–æ

        // –ò–Ω–¥–µ–∫—Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –±—É–∫–≤—ã —Å–ª–æ–≤–∞ –∏–ª–∏ -1 –µ—Å–ª–∏ –Ω–µ—Ç
        const preEnd = text.indexOf(' ', offset);
        // –µ—Å–ª–∏ -1 –æ–¥–∏–Ω —Ç–æ –∫–æ–Ω–µ—Ü —ç—Ç–æ –∫–æ–Ω—á–µ —Å—Ç—Ä–æ–∫–∏
        let end = preEnd !== -1 ?  preEnd : text.length;


        

        if(startFirst < start)// –∫–æ–≥–¥–∞ –≤—ã–¥–µ–ª—è—Ç—Å—è —Ç–µ–∫—Å—Ç –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ü–∞ 
            start = startFirst
        else if(start < startFirst) // –∫–æ–≥–¥–∞ –≤—ã–¥–µ–ª—è—Ç—Å—è —Ç–µ–∫—Å—Ç –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—á–∞–ª–∞ 
            end = startLast
        else if(!startFirst){ // –ø–µ—Ä–≤—ã–π —Ä–∞–∑
            startFirst = start
            startLast = end
        } 
        else return
        


        range.setStart(range.startContainer, start)
        range.setEnd(range.startContainer, end)
       
        selection.removeAllRanges(); // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è
        selection.addRange(range); // –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω

    });

    document.addEventListener('touchend', function(event){
        const words = selection.getRangeAt(0).toString()
        const countWords = words.split(' ').length

        // TODO: –ï—Å–ª–∏ –µ—Å—Ç—å .!? –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ —Ç–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å 
        if (2 <= countWords && countWords <= 4){

            const strong = document.createElement('strong')

            selection.getRangeAt(0).surroundContents(strong)

            
            translateText(words, strong)
        }

       
        selection.removeAllRanges(); // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è

        // TODO: –±–∞–≥ –ø–µ—Ä–µ—Å–∫–∞–∫–∏–≤–∞–µ—Ç —á–µ—Ä–µ–∑ strong
        // TODO: —á—Ç–æ –±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–¥–µ–ª–∏—Ç—å strong –ø–æ–≤—Ç—Ä–æ–Ω–æ —Å –±–æ–ª—å—à–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
        startFirst = undefined
        // startLast = undefined
    })
   </script>

</head>
<body>
    <p>
        <span id='process' ></span>
    </p>
</body>
</html>
